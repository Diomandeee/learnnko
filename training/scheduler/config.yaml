# N'Ko Training Pipeline - Streaming Scheduler Configuration
# ============================================================
# This config controls the continuous training loop.
# Modify these values to adjust throughput in real-time.
# The scheduler watches this file for changes.

# Schedule
schedule:
  start_date: "2025-01-01"
  end_date: "2025-01-31"
  timezone: "America/New_York"
  
  # Processing windows (when to run)
  active_hours:
    start: 0   # 12 AM (run 24/7 by default)
    end: 24    # 12 AM
  
  # Days to run (0=Mon, 6=Sun)
  active_days: [0, 1, 2, 3, 4, 5, 6]

# Throughput Control
# ------------------
# Adjust these in real-time to speed up or slow down
throughput:
  # Videos per day (can be fractional)
  # 532 videos / 31 days = 17.2 videos/day baseline
  # Start at 12, ramp up as we validate
  videos_per_day: 12
  
  # Minimum delay between videos (seconds)
  min_video_interval_seconds: 300  # 5 minutes
  
  # Maximum concurrent video analyses
  max_concurrent_videos: 2
  
  # Frames per video (after filtering)
  expected_frames_per_video: 50
  
  # Worlds per frame (for exploration)
  worlds_per_frame: 5

# Budget Control
# --------------
budget:
  # Maximum daily spend (USD)
  max_daily_budget_usd: 15.0
  
  # Maximum total budget (USD)
  max_total_budget_usd: 300.0
  
  # Pause if budget exceeded
  pause_on_budget_exceeded: true
  
  # Alert thresholds (percentage of total)
  alert_thresholds: [25, 50, 75, 90]

# Processing Stages
# -----------------
stages:
  # Stage 1: Multimodal frame analysis (~$0.01/frame)
  stage_1_ocr:
    enabled: true
    batch_size: 10
    timeout_seconds: 300
  
  # Stage 2: Text-only world exploration (~$0.0001/world)
  stage_2_worlds:
    enabled: true
    enabled_worlds:
      - everyday
      - formal
      - storytelling
      - proverbs
      - educational
  
  # Stage 3: Knowledge injection from Supabase
  stage_3_knowledge:
    enabled: true
    cache_ttl_seconds: 3600

# Rate Limiting
# -------------
rate_limiting:
  # Gemini API limits
  requests_per_minute: 60
  tokens_per_minute: 1000000
  
  # Backoff on rate limit
  backoff_base_seconds: 2
  backoff_max_seconds: 120
  backoff_multiplier: 2

# Logging & Monitoring
# --------------------
monitoring:
  # Log level: debug, info, warn, error
  log_level: info
  
  # Progress report interval (seconds)
  progress_report_interval: 300  # Every 5 minutes
  
  # Metrics export to Supabase
  export_metrics: true
  metrics_interval_seconds: 60

# Recovery
# --------
recovery:
  # Checkpoint frequency (videos)
  checkpoint_interval: 10
  
  # Auto-resume on restart
  auto_resume: true
  
  # Retry failed videos
  retry_failed: true
  max_retries: 3

# Video Source
# ------------
source:
  channel: "@babamamadidiane"
  playlist_url: null  # Use channel videos
  shuffle: false      # Process in order
  
  # Skip already processed videos
  skip_processed: true
  
  # Filter criteria
  min_duration_seconds: 60
  max_duration_seconds: 3600

# Analyzer Backend (Comp-Core)
# ----------------------------
analyzer:
  url: https://cc-music-pipeline-513507963446.us-central1.run.app
  submit_endpoint: /api/batch/submit
  status_endpoint: /api/batch/status
  results_endpoint: /api/batch/results
  timeout_seconds: 300

# RAG++ Integration (learnnko-specific)
# -------------------------------------
# RAG++ provides:
#   - Semantic search for related content
#   - Training data ingestion (memory_turns)
#   - Trajectory context for exploration
#   - CognitiveTwin training triggers
rag:
  enabled: true
  url: https://rag-plusplus-274020562532.us-central1.run.app
  
  # Project settings
  project_name: NKo-Training
  
  # Ingestion settings
  ingest_training_data: true    # Store detections and world variants
  ingest_batch_size: 10         # Turns per batch
  
  # Context retrieval settings
  context_limit: 5              # Max related turns to fetch
  context_similarity_threshold: 0.7
  
  # Training triggers
  trigger_training_on_session_end: true
  training_mode: batch_turns    # batch_turns or incremental
  training_limit: 200           # Max turns per training batch

# Prompts Configuration
# ---------------------
prompts:
  # Source: yaml (local files) or supabase (database)
  source: yaml
  
  # YAML directory (relative to learnnko root)
  yaml_dir: ./prompts/nko
  
  # Supabase prompts table
  supabase_table: nko_prompts
  
  # Prefer database over YAML (if using supabase source)
  prefer_database: true

